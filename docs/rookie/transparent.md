---
title: é€æ˜ä»£ç†
---

# archlinux é€æ˜ä»£ç†

> ### ğŸ•Š çºµä½¿åƒå±±å¤šä¸‡å£‘ï¼ŒçŠ¹æœ‰é’é¸¾è¸äº‘é—´
>
> å…¨çƒåŒ–æµªæ½®æ— æ³•é˜»æŒ¡ï¼Œæˆ‘ä»¬å¸¸å¸¸æœ‰è®¿é—®ä¸€äº›èµ„æ–™çš„å®¢è§‚éœ€æ±‚ã€‚ä½†æœ‰çš„æ—¶å€™å› ä¸ºä¸€äº›å› ç´ å¾€å¾€å¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®ã€‚è™½ç„¶å‰è·¯åƒæ²Ÿä¸‡å£‘ï¼Œä½†æ— æ³•é˜»æŒ¡æˆ‘ä»¬å‰è¡Œçš„è„šæ­¥ã€‚æœ¬èŠ‚æˆ‘ä»¬é€šè¿‡è®¾ç½®é€æ˜ä»£ç†è§£å†³è¿™ä¸€é—®é¢˜

> ### ğŸ”– è¿™ä¸€èŠ‚å°†ä¼šè®¨è®ºï¼š
>
> [[toc]]

::: danger â˜¢ï¸ è­¦å‘Š

_ç¬¬å…­æ¡ã€€è®¡ç®—æœºä¿¡æ¯ç½‘ç»œç›´æ¥è¿›è¡Œå›½é™…è”ç½‘ï¼Œå¿…é¡»ä½¿ç”¨é‚®ç”µéƒ¨å›½å®¶å…¬ç”¨ç”µä¿¡ç½‘æä¾›çš„å›½é™…å‡ºå…¥å£ä¿¡é“ã€‚_

_ä»»ä½•å•ä½å’Œä¸ªäººä¸å¾—è‡ªè¡Œå»ºç«‹æˆ–è€…ä½¿ç”¨å…¶ä»–ä¿¡é“è¿›è¡Œå›½é™…è”ç½‘ã€‚_

-- ä¸­åäººæ°‘å…±å’Œå›½è®¡ç®—æœºä¿¡æ¯ç½‘ç»œå›½é™…è”ç½‘ç®¡ç†æš‚è¡Œè§„å®š

:::

## 1. å®‰è£… Qv2ray å’Œ V2Ray / Xray å†…æ ¸

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… [Qv2ray](https://github.com/Qv2ray/Qv2ray)<sup>cn</sup> å’Œ [V2Ray](https://archlinux.org/packages/?sort=&q=v2ray&maintainer=&flagged=) / [Xray](https://github.com/XTLS/Xray-core)<sup>cn</sup> å†…æ ¸ï¼š

:::: code-group
::: code-group-item V2Ray

```bash
sudo pacman -S qv2ray-dev-git v2ray
```

:::
::: code-group-item Xray

```bash
sudo pacman -S qv2ray-dev-git xray
```

:::
::::

::: tip â„¹ï¸ æç¤º

è‹¥å®‰è£… V2Ray æ ¸å¿ƒæ—¶æŠ¥é”™ï¼Œè¯·å°è¯•æ›´æ¢é•œåƒæºã€‚

:::

![Qv2ray](../static/rookie/transparent_qv2ray.png)

> #### ğŸ“‘ ç›¸å…³èµ„æ–™ï¼šQv2ray
>
> Qv2ray æ˜¯ä¸€ä¸ªä½¿ç”¨ Qt ç¼–å†™çš„è·¨å¹³å°çš„ v2ray å›¾å½¢å‰ç«¯ã€‚

## 2. é…ç½® Qv2ray

1. æ‰“å¼€ Qv2ray > ç‚¹å‡» `é¦–é€‰é¡¹`ï¼š

![Qv2ray_config-1](../static/rookie/transparent_cfg-1.png)

2. åœ¨ `å†…æ ¸è®¾ç½®` é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡» `æ£€æŸ¥ V2Ray æ ¸å¿ƒè®¾ç½®` ä»¥éªŒè¯ V2Ray æ ¸å¿ƒè®¾ç½®ï¼š

![Qv2ray_config-2](../static/rookie/transparent_cfg-2.png)

::: tip â„¹ï¸ æç¤º

1. è‹¥ä½¿ç”¨ Xray å†…æ ¸ï¼Œåˆ™å…ˆéœ€ä¿®æ”¹ï¼š

   1. `V2Ray æ ¸å¿ƒå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„` ä¸º `/usr/bin/xray`

   2. `V2Ray èµ„æºç›®å½•` ä¸º `/usr/share/xray`

2. å†ç‚¹å‡» `æ£€æŸ¥ V2Ray æ ¸å¿ƒè®¾ç½®` ä»¥éªŒè¯ Xray æ ¸å¿ƒè®¾ç½®ï¼š

![Qv2ray_config-3](../static/rookie/transparent_cfg-3.png)

:::

## 3. é…ç½®è®¢é˜…

1. åœ¨ä¸»çª—å£ä¸­ç‚¹å‡» `åˆ†ç»„`ï¼š

![Qv2ray_config-4](../static/rookie/transparent_cfg-4.png)

2. ä¿®æ”¹ `åˆ†ç»„åç§°` çš„ `é»˜è®¤åˆ†ç»„` ä¸ºè‡ªå®šä¹‰åç§°ï¼ˆé€šå¸¸ä¸º âœˆ åœºåç§°ï¼‰ï¼š

![Qv2ray_config-5](../static/rookie/transparent_cfg-5.png)

3. åˆ‡æ¢åˆ° `è®¢é˜…è®¾ç½®` é€‰é¡¹å¡å¹¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

   1. å‹¾é€‰ `æ­¤ç»„æ˜¯ä¸€ä¸ªè®¢é˜…`

   2. è®¾ç½® `è®¢é˜…åœ°å€` ä¸º âœˆ åœºæä¾›çš„ `è®¢é˜…é“¾æ¥`

   3. ç‚¹å‡» `æ›´æ–°è®¢é˜…` æŒ‰é’®å¹¶ç­‰å¾…å®Œæˆ

   4. ç‚¹å‡» `ç¡®å®š` ä»¥åº”ç”¨è®¾ç½®å¹¶å…³é—­å¯¹è¯æ¡†

![Qv2ray_config-6](../static/rookie/transparent_cfg-6.png)

::: tip â„¹ï¸ æç¤º

è‹¥ä½¿ç”¨ `qv2ray-dev-git`<sup>cn</sup>ï¼Œåˆ™éœ€è¦æ³¨æ„çš„æ˜¯æœ€æ–°çš„ `qv2ray-dev-git` å·²ç»å°†æœºåœºçš„é»˜è®¤è®¢é˜…ç±»å‹æ”¹ä¸ºè§„èŒƒ `SIP008`ã€‚

å¦‚æœä½ çš„ âœˆ åœºè®¢é˜…ç±»å‹ä¸º `base64`ï¼Œåˆ™éœ€è¦åœ¨ `è®¢é˜…è®¾ç½®` é¢æ¿ > `è®¢é˜…ç±»å‹` ä¸­ï¼Œå°† `SIP008` æ”¹ä¸º `base64`ï¼Œå¦åˆ™ä½ å°†æ‹¿ä¸åˆ°è®¢é˜…é“¾æ¥ä¸­çš„ä»»ä½•èŠ‚ç‚¹ã€‚

:::

## 4. é€šè¿‡ç³»ç»Ÿä»£ç†æ–¹å¼å°è¯•è¿æ¥

1. åŒå‡»åˆ†ç»„ä¸­æ·»åŠ çš„è®¢é˜…å³å¯æŸ¥çœ‹æ›´æ–°å‡ºçš„èŠ‚ç‚¹ï¼Œå³é”®å¹¶ç‚¹å‡» `æµ‹è¯•å»¶è¿Ÿ` å¯ä»¥æµ‹è¯•åˆ†ç»„æˆ–èŠ‚ç‚¹çš„å»¶è¿Ÿï¼š

![Qv2ray_connect-1](../static/rookie/transparent_connect-1.png)

2. å³é”®éœ€è¦è¿æ¥çš„èŠ‚ç‚¹ > ç‚¹å‡» `è¿æ¥åˆ°æ­¤æœåŠ¡å™¨` å³å¯è¿æ¥ï¼š

![Qv2ray_connect-2](../static/rookie/transparent_connect-2.png)

3. æ‰“å¼€ä¸å­˜åœ¨çš„ç½‘ç«™éªŒè¯è¿æ¥ï¼š

![Qv2ray_connect-3](../static/rookie/transparent_connect-3.png)

::: tip â„¹ï¸ æç¤º

Qv2ray ä¼šè‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†ã€‚ä¹Ÿå¯ä»¥ç‚¹å‡»æ‰˜ç›˜å›¾æ ‡ > åœ¨å¼¹å‡ºèœå•ä¸­ï¼Œä¾æ¬¡é€‰æ‹© `ç³»ç»Ÿä»£ç†` > `å¯ç”¨ / ç¦ç”¨ç³»ç»Ÿä»£ç†` ä»¥å¯ç”¨æˆ–ç¦ç”¨ç³»ç»Ÿä»£ç†ã€‚

:::

::: tip â„¹ï¸ æç¤º

GNOME çš„ç³»ç»Ÿä»£ç†è®¾ç½®éå¸¸æœ‰æ•ˆã€‚è¿™æ˜¯å› ä¸º GNOME çš„ç³»ç»Ÿä»£ç†è®¾ç½®å¾—åˆ°äº†æ™®éçš„é€‚é…ã€‚

ä½†æ˜¯ KDE çš„ç³»ç»Ÿä»£ç†è®¾ç½®æ›´åƒæ˜¯ä¸€ä¸ªç©å…·ã€‚ç”šè‡³ KDE ç³»åˆ—åº”ç”¨ç¨‹åºæœ¬èº«ä¹Ÿä¸ä¼šè¯»å–å’Œä½¿ç”¨é‚£ä¸ªé…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡è®¾ç½®é€æ˜ä»£ç†çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åŒæ—¶è¿™ä¹Ÿå¯ä»¥ä½¿ç»ˆç«¯ä¸‹çš„åº”ç”¨ä½¿ç”¨ä»£ç†è¿æ¥ï¼ˆå¦‚ gitï¼‰ã€‚

:::

## 5. å®‰è£… cgproxy

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… [cgproxy](https://github.com/springzfx/cgproxy)<sup>cn / aur</sup>ï¼š

:::: code-group
::: code-group-item cn

```bash
sudo pacman -S cgproxy-git
```

:::
::: code-group-item aur

```bash
yay -S aur/cgproxy
```

:::
::::

## 6. é…ç½® Qv2ray é€æ˜ä»£ç†è®¾ç½®

1. æ‰“å¼€ Qv2ray > `é¦–é€‰é¡¹` > `å…¥ç«™è®¾ç½®` > å–æ¶ˆå‹¾é€‰ `è®¾ç½®ç³»ç»Ÿä»£ç†`ï¼š

![Qv2ray_transparent-1](../static/rookie/transparent_transparent-qv2ray-1.png)

2. å‹¾é€‰ `é€æ˜ä»£ç†è®¾ç½®`ï¼š

![Qv2ray_transparent-2](../static/rookie/transparent_transparent-qv2ray-2.png)

å…¶å®ƒè®¾ç½®ä¿æŒé»˜è®¤å³å¯ï¼Œ`IPv4 ç«¯å£` å¯è‡ªå®šä¹‰ä¸ºå…¶å®ƒç«¯å£ã€‚

::: tip â„¹ï¸ æç¤º

å…³äºä»£ç† `udp` æµé‡çš„è®¾ç½®ç¨å¾®æœ‰ä¸€äº›å¤æ‚ï¼Œé…ç½®æœ‰è¯¯ä¾¿ä¼šå¯¼è‡´æ— æ³•ä¸Šç½‘ã€‚

æœ¬æŒ‡å—ä¸å¯¹æ­¤å±•å¼€ä»‹ç»ï¼Œå¦‚æœ‰éœ€è¦å¯å‚è€ƒ [Project V å®˜æ–¹ç½‘ç«™ç›¸å…³å†…å®¹](https://www.v2ray.com/chapter_02/04_dns.html)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ä»£ç† `udp` æµé‡ã€‚

è€Œå±äº `udp` ç±»å‹çš„ `dns` æµé‡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç³»ç»Ÿè®¾ç½®é‡Œè®¾ç½®ä¸€ä¸ªå¯ç”¨çš„ DNS æœåŠ¡å™¨å³å¯ã€‚

:::

3. ç‚¹å‡» `ç¡®å®š` ä¿å­˜è®¾ç½®

## 7. é…ç½® cgproxy

1. é€šè¿‡ `vim` ç¼–è¾‘ `/etc/cgproxy/config.json` æ–‡ä»¶ï¼š

```bash
sudo vim /etc/cgproxy/config.json
```

è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š

- åœ¨ `cgroup_proxy` ä¸­æ‹¬å·é‡ŒåŠ ä¸Š `"/"`ï¼ˆåŒ…å«å¼•å·ï¼‰
- å°† `port` æ”¹ä¸º Qv2ray é¦–é€‰é¡¹é‡Œçš„é€æ˜ä»£ç†ç«¯å£ï¼ˆé»˜è®¤æ˜¯å’Œ Qv2ray é»˜è®¤å¯¹åº”çš„ `12345`ï¼‰
- å°† `enable_dns`ã€`enable_udp`ã€`enable_ipv6` æ”¹ä¸º `false`
- å¦‚æœå¸Œæœ›å½“æœ¬æœºä½œä¸ºç½‘å…³è®¾å¤‡æ—¶ä¸ºè¿æ¥åˆ°æœ¬æœºç½‘å…³çš„å…¶ä»–è®¾å¤‡ï¼ˆå¦‚è¿æ¥åˆ°æœ¬æœºå¼€è®¾çš„ wifi çƒ­ç‚¹çš„è®¾å¤‡ï¼‰ä¹Ÿæä¾›é€æ˜ä»£ç†ï¼Œåˆ™å°† `enable_gateway` æ”¹ä¸º `true`

![cgproxy](../static/rookie/transparent_cgproxy.png)

::: tip â„¹ï¸ æç¤º

cgproxy é»˜è®¤é…ç½®æ˜¯ä»£ç†æ‰€æœ‰ `tcp` å’Œ `udp`ã€`ipv4` å’Œ `ipv6` çš„æµé‡ã€‚

å¦‚æœä¸å¸Œæœ›ä»£ç†å…¶ä¸­çš„æŸç§ï¼ˆäº›ï¼‰æµé‡ï¼Œåˆ™å°†å¯¹åº”çš„ `enable_xxx` æ”¹ä¸º `false`ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„é…ç½®è¦å’Œ Qv2ray é€‰é¡¹é‡Œçš„é…ç½®ä¸€è‡´ï¼ˆä¾‹å¦‚ Qv2ray é€‰é¡¹é‡Œæ²¡æœ‰å‹¾é€‰ `udp`ï¼Œåˆ™è¿™é‡ŒåŠ¡å¿…æŠŠ `enable_udp` æ”¹ä¸º `false`ï¼‰

:::

2. ä¿å­˜å¹¶é€€å‡º `vim`

## 8. é…ç½®å¯ç”¨çš„ DNS æœåŠ¡

1. æ‰“å¼€ `ç³»ç»Ÿè®¾ç½®` > ç‚¹å‡»ä¾§æ  `è¿æ¥`ï¼š

![system-config_step-1](../static/rookie/transparent_system-cfg-1.png)

2. é€‰æ‹©å½“å‰è¿æ¥ > ç‚¹å‡» `ipv4` é€‰é¡¹å¡ï¼š

![system-config_step-2](../static/rookie/transparent_system-cfg-2.png)

3. åœ¨ `å…¶å®ƒ DNS æœåŠ¡å™¨` ä¸­æ·»åŠ æ²¡æœ‰æ±¡æŸ“çš„ DNS æœåŠ¡å™¨ï¼š

![system-config_step-3](../static/rookie/transparent_system-cfg-3.png)

4. ä¿å­˜å¹¶é€€å‡ºç³»ç»Ÿè®¾ç½®

## 9. å¯åŠ¨ cgproxy æœåŠ¡

1. åœ¨ Qv2ray ä¸­è¿æ¥ä¸€ä¸ªèŠ‚ç‚¹

2. åœ¨ Qv2ray æ‰˜ç›˜èœå•ä¸­å…³é—­ç³»ç»Ÿä»£ç†ï¼ˆå¦‚æœå·²ç»å¯åŠ¨ï¼‰

3. é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ cgproxy æœåŠ¡ï¼š

```bash
sudo systemctl start cgproxy.service
```

4. é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ cgproxy æœåŠ¡è¿è¡Œæƒ…å†µï¼š

```bash
systemctl status cgproxy.service
```

![cgproxy-start](../static/rookie/transparent_cgproxy-start.png)

5. æ‰“å¼€ä¸å­˜åœ¨çš„ç½‘ç«™éªŒè¯è¿æ¥ï¼š

![check](../static/rookie/transparent_check.png)

> ğŸ“” æœ¬èŠ‚å‚è€ƒèµ„æ–™ï¼š
>
> - [Qv2ray](https://qv2ray.net/lang/zh/)
