# Linux æ—¥å¸¸æ“ä½œä¸åŸºç¡€çŸ¥è¯†

> ### ğŸ±â€ğŸš€ è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢
>
> é˜…è¯»å®Œ ğŸŒ± æ–°æ‰‹ä¸Šè·¯ç« èŠ‚ï¼Œä½ çš„ç³»ç»Ÿå·²å®Œå…¨å¯ä»¥ä½¿ç”¨
>
> KDE æ¡Œé¢ç¯å¢ƒæä¾›äº†å¼ºå¤§çš„ [GUI](https://zh.wikipedia.org/wiki/%E5%9B%BE%E5%BD%A2%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2) ä»¥ä¾›æ™®é€šç”¨æˆ·ä½¿ç”¨
>
> ç»å¤§å¤šæ•°ç³»ç»Ÿè®¾ç½®é¡¹å¯åœ¨ KDE ç³»ç»Ÿè®¾ç½®ä¸­æ‰¾åˆ°ï¼ˆå°±åƒ Windows ä¸€æ ·ï¼ï¼‰
>
> ä½†å¦‚æœæƒ³è¦æ¸¸åˆƒæœ‰ä½™çš„æŒæ§ä½ çš„ç³»ç»Ÿï¼Œä½ è¿˜éœ€è¦é˜…è¯»æŒæ¡æœ¬å°èŠ‚çš„å†…å®¹

::: tip â„¹ï¸ æç¤º

å¦‚æœä½ æƒ³è¿›ä¸€æ­¥è¯¦ç»†äº†è§£æœ¬æ–‡å„éƒ¨åˆ†çš„è¯¦ç»†çŸ¥è¯†ï¼Œå¯ä»¥ç‚¹å‡»åœ¨å„ä¸ªå°èŠ‚ç»™å‡ºçš„ç›¸å…³é“¾æ¥è¿›è¡Œå­¦ä¹ ã€‚

å¦‚æœä½ ä¸æƒ³è¯¦ç»†äº†è§£ï¼Œæœ¬ç« ä»‹ç»çš„çŸ¥è¯†ä¹Ÿè¶³å¤Ÿä½ æ¥åº”ä»˜æ—¥å¸¸çš„ä½¿ç”¨ã€‚

:::

## å¿…é¡»æŒæ¡çš„ Linux çŸ¥è¯†

æ­¤å¤„åªä»‹ç»æœ€åŸºæœ¬çš„ï¼Œæœ€å¿…è¦çš„ Linux çŸ¥è¯†ç‚¹ä¸å°æŠ€å·§ã€‚

1. åœ¨ Linux ä¸­ï¼Œæ–‡ä»¶ç›®å½•ç»“æ„ä¸ Windows å®Œå…¨ä¸åŒã€‚Windows å­˜åœ¨ C ç›˜ã€D ç›˜ç­‰ç›˜ç¬¦ï¼Œè€Œåœ¨ Linux ä¸­ä¸å­˜åœ¨è¿™äº›åˆ’åˆ†ã€‚æœ€ä¸Šå±‚çš„ç›®å½•æ˜¯æ ¹ç›®å½•ï¼Œè·¯å¾„ä¸º `/` ï¼Œå¹¶ä»¥ä¸€ä¸ªæ ‘å½¢ç»“æ„ä»æ­¤å‘ä¸‹ä¸€çº§ä¸€çº§åŒºåˆ†
2. å¯¹äº Linux çš„æ ‘å½¢æ–‡ä»¶ç»“æ„ï¼Œå­˜åœ¨ç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„ä¹‹åˆ†ï¼š

   - ç»å¯¹è·¯å¾„ä»£è¡¨ä»æ ¹ç›®å½• `/` å¼€å§‹çš„å®Œæ•´è·¯å¾„ï¼š

     - æ¯”å¦‚ `/home/myusername/Download`

   - ç›¸å¯¹è·¯å¾„ä»£è¡¨ä»å½“å‰ç›®å½•æˆ–å½“å‰ç›®å½•çš„ä¸Šçº§ç›®å½•ï¼Œåˆ°ç›®æ ‡ç›®å½•çš„ä¸€ä¸ªéƒ¨åˆ†è·¯å¾„ï¼š

     - `.` ä»£è¡¨å½“å‰ç›®å½•
     - `..` ä»£è¡¨å½“å‰ç›®å½•çš„ä¸Šçº§ç›®å½•
     - æ¯”å¦‚å½“å‰ä½ æ‰€åœ¨çš„ç›®å½•ä¸º `/home/myusername` ï¼Œé‚£ä¹ˆç»å¯¹è·¯å¾„ä¸‹çš„ `/home/myusername/Download` æ–‡ä»¶å¤¹çš„ç›¸å¯¹è·¯å¾„å³ä¸º `./Download`

     - æ¯”å¦‚ä½ å½“å‰æ‰€åœ¨çš„è·¯å¾„ä¸º `/home/myusername/Download` ï¼Œå‘ä¸Šå¯»æ‰¾åˆ° `/home/myusername/Desktop` çš„ç›¸å¯¹è·¯å¾„å³ä¸º `../Desktop`

3. ç®€å•æ¥è¯´ï¼ŒLinux ä¸­å­˜åœ¨ä¸¤ç±»ç”¨æˆ·ï¼š

   - ç¬¬ä¸€ç±»ç”¨æˆ·å³ä¸º root ç”¨æˆ·ï¼Œä¹Ÿç§°ä¸ºè¶…çº§ç”¨æˆ·ï¼Œå®ƒæ‹¥æœ‰ç³»ç»Ÿä¸­æœ€é«˜çš„æƒé™
   - ç¬¬äºŒç±»ç”¨æˆ·å°±æ˜¯é™¤äº† root ç”¨æˆ·ä¹‹å¤–çš„æ™®é€šç”¨æˆ·ï¼Œå®ƒä»¬å¯ä»¥æ‹¥æœ‰ä¸åŒç­‰çº§çš„æƒé™

     ä½¿ç”¨ root æƒé™æ—¶éœ€è¦ååˆ†å°å¿ƒ

4. ç†è®ºä¸Šæ¥è¯´ï¼Œä»»ä½•å›¾å½¢åŒ–ç•Œé¢ä¸­çš„æ“ä½œéƒ½å¯ä»¥ç”¨å¯¹åº”çš„å‘½ä»¤è¡Œå‘½ä»¤å®Œæˆã€‚å¦‚æœä½ æ‰“å¼€æŸä¸ªç¨‹åºæŠ¥é”™ï¼Œä¸å¦¨è¯•è¯•æ‰¾åˆ°å®ƒçš„å¯¹åº”å¯åŠ¨å‘½ä»¤ï¼Œåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œå¹¶è§‚å¯Ÿå®ƒè¿è¡Œæ—¶çš„é”™è¯¯æ—¥å¿—è¾“å‡ºï¼ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ï¼Œè§£å†³é—®é¢˜
   
5. ä¸èƒ½æœªç»è¾¨åˆ«æ‰§è¡Œæ¥æºä¸æ˜çš„å‘½ä»¤ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

   ::: danger â˜¢ï¸ è­¦å‘Š

   è¯¥å‘½ä»¤å…·æœ‰é«˜å±é™©æ€§ï¼Œè¯·å‹¿æ‰§è¡Œã€‚

   :::
   
   ```sh
   echo "c3VkbyBybSAtcmYgLyo=" | base64 -d | zsh
   ```
   å®ƒçš„å«ä¹‰æ˜¯è®© zsh æ‰§è¡Œ `sudo rm -rf /*`, ä¼šæ‘§æ¯æ•´ä¸ªç³»ç»Ÿã€‚
   
## ç»ˆç«¯æ“ä½œåŸºç¡€

å¦‚æœæƒ³è¦ç†Ÿç»ƒæŒæ¡ Linuxï¼Œå°±å¿…é¡»æŒæ¡ç»ˆç«¯çš„å¸¸è§å‘½ä»¤ä¸ä½¿ç”¨æ–¹å¼ã€‚

```bash
ls /some_path # æŸ¥çœ‹æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¸å­æ–‡ä»¶å¤¹ã€‚/ ä»£è¡¨æ ¹ç›®å½•ï¼Œæ˜¯ Linux æœ€é¡¶ç«¯çš„è·¯å¾„ï¼Œä»¥æ­¤å¼€å¤´åˆ™ä¸ºç»å¯¹è·¯å¾„
pwd # æŸ¥çœ‹å½“å‰ç»ˆç«¯æ‰€åœ¨è·¯å¾„
cat /home/testuser/testfile # ä»¥è¾“å‡ºæµæ–¹å¼æŸ¥çœ‹æŸä¸ªæ–‡ä»¶
cd /home/testuser # åˆ‡æ¢ç›®å½•å‘½ä»¤ã€‚å°†å½“å‰ç»ˆç«¯åˆ‡æ¢åˆ°æŸä¸€ä¸ªè·¯å¾„ä¸‹
cp ./a.py ./b.py # å¤åˆ¶å‘½ä»¤ã€‚å°†å½“å‰è·¯å¾„ä¸‹çš„ a.py å¤åˆ¶ä¸€ä»½å¹¶å‘½åä¸º b.pyã€‚./ ä»£è¡¨å½“å‰æ–‡ä»¶å¤¹æ‰€åœ¨è·¯å¾„ï¼Œä»¥æ­¤å¼€å¤´åˆ™ä¸ºç›¸å¯¹è·¯å¾„
cp -r ./a ./b # å¤åˆ¶æ•´ä½“æ–‡ä»¶å¤¹
rm b.py # åˆ é™¤å‘½ä»¤ã€‚åˆ é™¤ b.py
mv a.py b.py # ç§»åŠ¨ï¼ˆé‡å‘½åï¼‰å‘½ä»¤ã€‚å°† a.py æ›´åä¸º b.py
mkdir my_folder # æ–°å»ºåä¸º my_folder çš„æ–‡ä»¶å¤¹
sudo some_command # ä½¿æ™®é€šç”¨æˆ·ä»¥ root æƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤
```

> ğŸ”— ç›¸å…³é“¾æ¥ï¼š
>
> - [Linux å‘½ä»¤è¡Œä¸ Shell è„šæœ¬æ•™ç¨‹](https://archlinuxstudio.github.io/ShellTutorial/#/)

## Pacman åŒ…ç®¡ç†

åœ¨ archlinux ä¸Šå®‰è£…çš„è½¯ä»¶éƒ½é€šè¿‡ Pacman æ¥è¿›è¡Œç®¡ç†ã€‚

ä¸ºäº†ä½¿ç”¨ Pacman é¢å¤–çš„å‘½ä»¤éœ€è¦å…ˆå®‰è£… [ `pacman-contrib` ](https://archlinux.org/packages/extra/x86_64/pacman-contrib/)<sup>extra / aur</sup>ã€‚

å®‰è£… `pacman-contrib` ï¼š

::: code-group

```bash [extra]
sudo pacman -S pacman-contrib
```

```bash [aur (git)]
yay -S pacman-contrib-git
```

:::

å¯ä»¥æŠŠ Pacman ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶ç®¡ç†å™¨ï¼ˆè½¯ä»¶ç®¡å®¶ï¼Ÿï¼‰ï¼Œå¯ä»¥è¿›è¡Œè½¯ä»¶çš„å®‰è£…ã€åˆ é™¤ã€æŸ¥è¯¢ç­‰ï¼š

```bash {1-4, 6-8, 10}
sudo pacman -S package_name # å®‰è£…è½¯ä»¶åŒ…
pacman -Ss # åœ¨åŒæ­¥æ•°æ®åº“ä¸­æœç´¢åŒ…ï¼ŒåŒ…æ‹¬åŒ…çš„åç§°å’Œæè¿°
sudo pacman -Syu # å‡çº§ç³»ç»Ÿã€‚ -y:æ ‡è®°åˆ·æ–°ã€-yyï¼šæ ‡è®°å¼ºåˆ¶åˆ·æ–°ã€-uï¼šæ ‡è®°å‡çº§åŠ¨ä½œï¼ˆä¸€èˆ¬ä½¿ç”¨ -Syu å³å¯ï¼‰
sudo pacman -Rns package_name # åˆ é™¤è½¯ä»¶åŒ…ï¼ŒåŠå…¶æ‰€æœ‰æ²¡æœ‰è¢«å…¶ä»–å·²å®‰è£…è½¯ä»¶åŒ…ä½¿ç”¨çš„ä¾èµ–åŒ…
sudo pacman -R package_name # åˆ é™¤è½¯ä»¶åŒ…ï¼Œä¿ç•™å…¶å…¨éƒ¨å·²ç»å®‰è£…çš„ä¾èµ–å…³ç³»
pacman -Qi package_name # æ£€æŸ¥å·²å®‰è£…åŒ…çš„ç›¸å…³ä¿¡æ¯ã€‚-Qï¼šæŸ¥è¯¢æœ¬åœ°è½¯ä»¶åŒ…æ•°æ®åº“
pacman -Qdt # æ‰¾å‡ºå­¤ç«‹åŒ…ã€‚-dï¼šæ ‡è®°ä¾èµ–åŒ…ã€-tï¼šæ ‡è®°ä¸éœ€è¦çš„åŒ…ã€-dtï¼šåˆå¹¶æ ‡è®°å­¤ç«‹åŒ…
sudo pacman -Rns $(pacman -Qtdq) # åˆ é™¤å­¤ç«‹åŒ…
sudo pacman -Fy # æ›´æ–°å‘½ä»¤æŸ¥è¯¢æ–‡ä»¶åˆ—è¡¨æ•°æ®åº“
pacman -F some_command # å½“ä¸çŸ¥é“æŸä¸ªå‘½ä»¤å±äºå“ªä¸ªåŒ…æ—¶ï¼Œç”¨æ¥åœ¨è¿œç¨‹è½¯ä»¶åŒ…ä¸­æŸ¥è¯¢æŸä¸ªå‘½ä»¤å±äºå“ªä¸ªåŒ…ï¼ˆå³ä½¿æ²¡æœ‰å®‰è£…ï¼‰
pactree package_name # æŸ¥çœ‹ä¸€ä¸ªåŒ…çš„ä¾èµ–æ ‘

```

> ğŸ”— ç›¸å…³é“¾æ¥ï¼š
>
> - [ArchWiki ç›¸å…³å†…å®¹](<https://wiki.archlinux.org/title/Pacman_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
>
> å…³äº Pacman å¸¸è§é”™è¯¯çš„æ’é™¤è¯·å‚é˜… [å¸¸è§é—®é¢˜](debug.md)ã€‚

::: danger â˜¢ï¸ è­¦å‘Š

éƒ¨åˆ† Pacman å‘½ä»¤å…·æœ‰å±é™©æ€§ï¼Œè¯·è°¨æ…æ‰§è¡Œã€‚

:::

::: tip â„¹ï¸ æç¤º

yay çš„ç”¨æ³•å’Œ Pacman æ˜¯åŸºæœ¬ä¸€æ ·çš„ã€‚æœ‰é¢å¤–å‡ æ¡å¸¸ç”¨å‘½ä»¤ï¼š

```bash {1-3}
yay # ç­‰åŒäº yay -Syu
yay package_name # ç­‰åŒäº yay -Ss package_name && yay -S package_name
yay -Ps # æ‰“å°ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
yay -Yc # æ¸…ç†ä¸éœ€è¦çš„ä¾èµ–
```

:::

### Octopi

æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–çš„åŒ…ç®¡ç†è½¯ä»¶ï¼ˆPacman / yay çš„å›¾å½¢å‰ç«¯ï¼‰[Octopi](https://github.com/aarnt/octopi)<sup>aur</sup>ã€‚

1. å®‰è£… Octopiï¼š

::: code-group

```bash [aur]
   yay -S octopi
```

```bash [aur (git)]
   yay -S octopi-git
```

:::

2. æ‰“å¼€ Octopi å³å¯çœ‹åˆ°å›¾å½¢åŒ–çš„ Pacman / yay ç•Œé¢ï¼š

![octopi](../../assets/guide/advanced/system-ctl/octopi.png)

> ğŸ”— ç›¸å…³é“¾æ¥ï¼š
>
> - [ArchWiki ç›¸å…³å†…å®¹](https://wiki.archlinux.org/index.php/Pacman)

### downgrade

ç”±äº archlinux çš„æ›´æ–°ç­–ç•¥å¾ˆæ¿€è¿›, å¯¼è‡´æŸäº›è½¯ä»¶è¿‡æ–°, è€Œä¸€äº›ä¾èµ–å¹¶æ²¡æœ‰æ”¯æŒ, æ¯”å¦‚è‘—åçš„[virtualbox åœ¨ linux5.18 å†…æ ¸ä¸‹çš„å´©æºƒ](https://bugs.archlinux.org/task/74900) , æ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸å®‰è£…è¿‡æ—¶çš„è½¯ä»¶æˆ–è€…é™çº§å·²å®‰è£…çš„è½¯ä»¶ã€‚

åœ¨ archlinux ä¸Šå®‰è£…æ—§ç‰ˆè½¯ä»¶éƒ½é€šè¿‡ downgrade æ¥è¿›è¡Œç®¡ç†ã€‚

ä¸ºäº†ä½¿ç”¨ downgrade é¢å¤–çš„å‘½ä»¤éœ€è¦å…ˆå®‰è£… [ `downgrade` ](https://aur.archlinux.org/packages/downgrade)<sup>aur</sup>ã€‚

```bash
yay -S downgrade
```

è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨ downgrade é™çº§è½¯ä»¶äº†

![downgrade](../../assets/guide/advanced/system-ctl/downgrade.jpg)

## ç»ˆç«¯ç¼–è¾‘å™¨ vim çš„ä½¿ç”¨

æˆ‘ä»¬éœ€è¦æŒæ¡ä¸€ä¸ªèƒ½åœ¨ç»ˆç«¯ä¸­è¿›è¡Œæ–‡æœ¬ç¼–è¾‘çš„è½¯ä»¶ï¼Œè¿™é‡Œä»‹ç» vimã€‚

1. åˆ›å»ºå¹¶ç¼–è¾‘åä¸º `hello.txt` çš„æ–‡ä»¶ï¼š

```bash
   vim hello.txt
```

2. æ­¤æ—¶å¯ä»¥çœ‹åˆ°è¿›å…¥äº†ä¸€ä¸ªç©ºçš„ç•Œé¢ï¼š

![vim](../../assets/guide/advanced/system-ctl/vim.png)

- æ­¤æ—¶å¤„åœ¨ vim çš„ `å‘½ä»¤æ¨¡å¼` ã€‚åœ¨ `å‘½ä»¤æ¨¡å¼` ä¸‹ï¼Œå¯ä»¥ç”¨ä¸€äº›å¿«æ·æŒ‡ä»¤æ¥å¯¹æ–‡æœ¬è¿›è¡Œæ“ä½œ
- è¾“å…¥ `a` è¿›å…¥ vim çš„ `ç¼–è¾‘æ¨¡å¼` ï¼Œæ­¤æ—¶å³å¯è¾“å…¥ä»»æ„æ–‡æœ¬è¿›è¡Œç¼–è¾‘
- åœ¨è¾“å…¥å®ŒæˆåæŒ‰ä¸‹ Esc é”®ï¼Œå³å¯ä» `ç¼–è¾‘æ¨¡å¼` é€€å‡ºåˆ° `å‘½ä»¤æ¨¡å¼` ã€‚æ­¤æ—¶è¾“å…¥ `:wq` å³å¯ä¿å­˜å¹¶é€€å‡º vim

ä¸‹é¢ä»‹ç»ä¸€äº›åœ¨å‘½ä»¤æ¨¡å¼ä¸‹å¸¸ç”¨çš„å‘½ä»¤ï¼š

- `:wq` â€”â€” ä¿å­˜é€€å‡º
- `:q!` â€”â€” ä¸ä¿å­˜ï¼Œå¼ºåˆ¶é€€å‡º
- `dd` â€”â€” åˆ é™¤ä¸€è¡Œ
- `2dd` â€”â€” åˆ é™¤ä¸¤è¡Œ
- `gg` â€”â€” å›åˆ°æ–‡æœ¬ç¬¬ä¸€è¡Œ
- `shift` + `g` â€”â€” è½¬åˆ°æ–‡æœ¬æœ€åä¸€è¡Œ
- `/xxx` â€”â€” åœ¨æ–‡ä¸­æœç´¢ xxx å†…å®¹ã€‚å›è½¦ `Enter` æœç´¢ï¼ŒæŒ‰ `n` é”®è½¬åˆ°ä¸‹ä¸€ä¸ª
- `?xxx` â€”â€” åå‘æœç´¢

::: tip â„¹ï¸ æç¤º

å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å­¦ä¹ å®Œæ•´çš„ vim æ•™ç¨‹ï¼š

```bash
vimtutor
```

![vimtutor](../../assets/guide/advanced/system-ctl/vimtutor.png)

:::

## ç³»ç»ŸæœåŠ¡çš„ä»‹ç»ä¸æ“ä½œ

Linux ç³»ç»Ÿä¸­è¿è¡Œç€å„ç§æœåŠ¡ï¼Œä½ éœ€è¦æŒæ¡æŸ¥è¯¢ï¼Œå˜æ›´æœåŠ¡çŠ¶æ€çš„æ–¹å¼ã€‚åŒæ—¶å¯¹åˆ›å»ºæœåŠ¡æœ€å¥½ä¹Ÿæœ‰å¤§è‡´çš„äº†è§£ã€‚

è¿™é‡Œè®²è¿°å‘½ä»¤ `systemctl` çš„ç”¨æ³•ã€‚ä»¥ `dhcpcd` æœåŠ¡ä¸ºä¾‹ï¼š

```bash
systemctl start dhcpcd # å¯åŠ¨æœåŠ¡
systemctl stop dhcpcd # åœæ­¢æœåŠ¡
systemctl restart dhcpcd # é‡å¯æœåŠ¡
systemctl reload dhcpcd # é‡æ–°åŠ è½½æœåŠ¡ä»¥åŠå®ƒçš„é…ç½®æ–‡ä»¶
systemctl status dhcpcd # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl enable dhcpcd # è®¾ç½®å¼€æœºå¯åŠ¨æœåŠ¡
systemctl enable --now dhcpcd # è®¾ç½®æœåŠ¡ä¸ºå¼€æœºå¯åŠ¨å¹¶ç«‹å³å¯åŠ¨è¿™ä¸ªå•å…ƒ
systemctl disable dhcpcd # å–æ¶ˆå¼€æœºè‡ªåŠ¨å¯åŠ¨
systemctl daemon-reload dhcpcd # é‡æ–°è½½å…¥ systemd é…ç½®ã€‚æ‰«ææ–°å¢æˆ–å˜æ›´çš„æœåŠ¡å•å…ƒã€ä¸ä¼šé‡æ–°åŠ è½½å˜æ›´çš„é…ç½®
```

> ğŸ”— ç›¸å…³é“¾æ¥ï¼š
>
> - [ArchWiki ç›¸å…³å†…å®¹](https://wiki.archlinux.org/index.php/Systemd#Basic_systemctl_usage)
> - [systemd é…ç½®æ–‡ä»¶æ ·ä¾‹è§£é‡Š](https://www.freedesktop.org/software/systemd/man/systemd.service.html#Examples)
>
> å…³äºå…³é—­å‡ºé”™æœåŠ¡ï¼ˆå‡ºé”™å¯åŠ¨é¡¹ï¼‰è¯·å‚é˜… [å¸¸è§é—®é¢˜](debug.md)ã€‚

## æ–‡ä»¶è§£å‹ç¼©

é™¤äº†ä¼—æ‰€å‘¨çŸ¥çš„ `tar` å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰å®‰è£…è¿‡çš„ `ark` åŒ…å¯ä»¥é…åˆ Dolphin æ–‡ä»¶ç®¡ç†å™¨è½»æ¾çš„å³é”®å‹ç¼©åŒ…ç›´æ¥è§£å‹ã€‚å…¶å¯é€‰ä¾èµ–æä¾›äº†å„ä¸ªå‹ç¼©æ ¼å¼çš„æ”¯æŒï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©å®‰è£…ã€‚

ä½†æ˜¯ä½¿ç”¨æ­¤æ–¹æ³•è§£å‹ Windows ä¸‹çš„å‹ç¼©åŒ…å¯èƒ½ä¼šä¹±ç ã€‚ä½¿ç”¨ [Unarchiver](https://archlinux.org/packages/extra/x86_64/unarchiver/) å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚

1. å®‰è£… Unarchiverï¼š

```bash
sudo pacman -S unarchiver
```

2. è§£å‹å‹ç¼©åŒ…ï¼š

```bash
unar xxx.zip
```

## ç£ç›˜ç©ºé—´ä¿¡æ¯

### df å‘½ä»¤

ä½¿ç”¨ `df` å‘½ä»¤å³å¯æ˜¾ç¤ºç›®å‰åœ¨ Linux ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ç³»ç»Ÿå¯¹åº”çš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µç»Ÿè®¡ï¼š

```bash
df -h # ä»¥äººç±»å¯è¯»æ ¼å¼æ˜¾ç¤º
```

### Filelight

ä½¿ç”¨ [Filelight](https://github.com/KDE/filelight)<sup>extra / aur</sup> å³å¯åœ¨å›¾å½¢åŒ–ç•Œé¢ç›´è§‚æŸ¥çœ‹ç£ç›˜å ç”¨æƒ…å†µã€‚

1. å®‰è£… Filelightï¼š

::: code-group

```bash [extra]
sudo pacman -S filelight
```

```bash [aur (git)]
yay -S filelight-git
```

:::

2. æ‰“å¼€ Filelight å³å¯ç›´è§‚çš„çœ‹åˆ°ç©ºé—´å ç”¨æƒ…å†µï¼š

![filelight](../../assets/guide/advanced/system-ctl/filelight.png)

::: tip â„¹ï¸ æç¤º

ç‚¹å‡»ç›¸åº”åŒºå—å³å¯è¿›ä¸€æ­¥æ·±å…¥åˆ†æã€‚

:::

## ç£ç›˜ç©ºé—´æ¸…ç†

æœ‰æ—¶éœ€è¦å¯¹ç£ç›˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œä»¥å…ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œä»è€Œä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚

é¦–å…ˆåº”é€šè¿‡ä¸Šæ–‡ä»‹ç»çš„å†…å®¹ [ç£ç›˜ç©ºé—´ä¿¡æ¯](/guide/system-ctl.md#ç£ç›˜ç©ºé—´ä¿¡æ¯) å¯¹ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µè¿›è¡Œåˆ†æï¼Œéšåé‡‡å–å¯¹åº”çš„æœ‰æ•ˆåº”å¯¹æªæ–½ã€‚

ä¸‹é¢ä»‹ç»ä¸€äº›é€šç”¨æªæ–½ã€‚

### æ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜åŠå­¤ç«‹åŒ…

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¸…ç†è½¯ä»¶åŒ…æ–‡ä»¶ç¼“å­˜åŠåˆ é™¤å­¤ç«‹è½¯ä»¶åŒ…ï¼š

```bash {1-2, 4}
sudo pacman -Rns $(pacman -Qtdq) # å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œåˆ é™¤å­¤ç«‹è½¯ä»¶åŒ…ï¼ˆå¸¸ç”¨ï¼‰
sudo pacman -Sc # åˆ é™¤å½“å‰æœªå®‰è£…çš„æ‰€æœ‰ç¼“å­˜åŒ…å’Œæœªä½¿ç”¨çš„åŒæ­¥æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
sudo pacman -Scc # ä»ç¼“å­˜ä¸­åˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™æ˜¯æœ€æ¿€è¿›çš„æ–¹æ³•ï¼Œä¸ä¼šåœ¨ç¼“å­˜æ–‡ä»¶å¤¹ä¸­ç•™ä¸‹ä»»ä½•å†…å®¹ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰
paccache -r # åˆ é™¤å·²å®‰è£…å’Œæœªå®‰è£…åŒ…çš„æ‰€æœ‰ç¼“å­˜ç‰ˆæœ¬ï¼Œä½†æœ€è¿‘ 3 ä¸ªç‰ˆæœ¬é™¤å¤–

```

è¿˜å¯ä»¥åœ¨ `/etc/pacman.d/hooks` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `clean_package_cache.hook` æ–‡ä»¶æ¥åœ¨ä½¿ç”¨ `pacman` æ—¶è‡ªåŠ¨æ‰§è¡Œ `paccache`ã€‚

```bash
[Trigger]
Operation = Upgrade
Operation = Install
Operation = Remove
Type = Package
Target = *

[Action]
Description = Cleaning pacman cache...
When = PostTransaction
Exec = /usr/bin/paccache -rk 2
```

### æ¸…ç† yay ç¼“å­˜

å¦‚æœä½¿ç”¨äº† yay æ¥å®‰è£… AUR ä¸­çš„è½¯ä»¶åŒ…çš„è¯ï¼Œå¯ä»¥é€‰æ‹©æ¸…ç† yay çš„ç¼“å­˜ç›®å½•ï¼š

```bash
rm -rf ~/.cache/yay
```

### è€ƒè™‘å¿«ç…§å¤§å°

è‹¥åœ¨æ­¥éª¤ [13. è®¾ç½® Timeshift å¿«ç…§](../rookie/desktop-env-and-app.md#_13-è®¾ç½®-timeshift-å¿«ç…§) ä¸­æ²¡æœ‰ä½¿ç”¨ BTRFS æ–¹å¼çš„ Timeshift å¿«ç…§ï¼Œè€Œæ˜¯ä½¿ç”¨äº† RSYNC æ–¹å¼çš„ Timeshift å¿«ç…§ï¼Œè¿˜åº”è€ƒè™‘ Timeshift å¿«ç…§å ç”¨æƒ…å†µã€‚

ä¸€èˆ¬æ¥è¯´ RSYNC æ–¹å¼çš„å¿«ç…§å¤§å°ç•¥å¤§äºå½“å‰å®é™…ä½¿ç”¨å¤§å°ã€‚å› ä¸ºè™½ç„¶ RSYNC æ–¹å¼çš„å¿«ç…§æ˜¯å¢é‡çš„ï¼Œä½†**å†å²æœ€ä¹…è¿œçš„å¿«ç…§ä¾ç„¶æ˜¯å®Œæ•´å¤‡ä»½**ï¼Œéšåæ‰æ˜¯å¢é‡çš„ã€‚è€Œç®€å•æ¥è¯´å¢é‡å¤§å°å–å†³äºå†å²æœ€ä¹…è¿œçš„å¿«ç…§å’Œæœ€æ–°å¿«ç…§ä¹‹é—´çš„å·®å¼‚ã€‚

é€šè¿‡ Timeshift è‡ªåŠ¨æ¸…ç†å†å²æœ€ä¹…è¿œçš„å¿«ç…§æ˜¯ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä½†ä»ç„¶éœ€è¦æ³¨æ„ä¸è¦ä¿å­˜å¤ªå¤šå¿«ç…§ã€‚

## ç¡¬ä»¶ä¿¡æ¯æ£€æµ‹

### ç£ç›˜ä¿¡æ¯

#### Smartmontools

[Smartmontools](https://archlinux.org/packages/extra/x86_64/smartmontools/) é€šè¿‡ä½¿ç”¨è‡ªæˆ‘ç›‘æ§ï¼ˆSelf-Monitoringï¼‰ã€åˆ†æï¼ˆAnalysisï¼‰å’ŒæŠ¥å‘Šï¼ˆReportingï¼‰ä¸‰ç§æŠ€æœ¯ï¼ˆç¼©å†™ä¸º S. M. A. R. T æˆ– SMARTï¼‰æ¥ç®¡ç†å’Œç›‘æ§å­˜å‚¨ç¡¬ä»¶ã€‚

1. å®‰è£… Smartmontoolsï¼š

```bash
sudo pacman -S smartmontools
```

2. æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼š

::: code-group

```bash [SATA]
sudo smartctl -A /dev/sdx # ç¡¬ç›˜
sudo smartctl -d sat -A /dev/sdx # USB è®¾å¤‡
```

```bash [NVME]
sudo smartctl -A /dev/nvmexn1 # ç¡¬ç›˜
sudo smartctl -d sat -A /dev/sdx # USB è®¾å¤‡
```

:::

### CPU ä¿¡æ¯

ç±»ä¼¼ Windows ä¸‹çš„ [CPU-Z](https://www.cpuid.com/softwares/cpu-z.html)<sup>EULA</sup>ï¼ŒLinux ä¸‹æœ‰ [CPU-X](https://x0rg.github.io/CPU-X/)<sup>cn / aur</sup>ã€‚

1. å®‰è£… CPU-Xï¼š

::: code-group

```bash [cn]
sudo pacman -S cpu-x
```

```bash [aur]
yay -S aur/cpu-x
```

```bash [aur (git)]
yay -S cpu-x-git
```

:::

2. æ‰“å¼€ CPU-X å³å¯çœ‹åˆ° CPU è¯¦ç»†ä¿¡æ¯ï¼š

![cpu-x](../../assets/guide/advanced/system-ctl/cpu-x.png)

### GPU ä¿¡æ¯

ä½¿ç”¨ [GPU-Viewer](https://github.com/arunsivaramanneo/GPU-Viewer)<sup>aur</sup> å³å¯ã€‚

1. å®‰è£… GPU-Viewerï¼š

```bash
yay -S gpu-viewer
```

2. æ‰“å¼€ GPU-Viewer å³å¯çœ‹åˆ° GPU è¯¦ç»†ä¿¡æ¯ï¼š

![gpu-viewer](../../assets/guide/advanced/system-ctl/gpu-viewer.png)

### ç¡¬ä»¶å®Œæ•´ä¿¡æ¯

ä½¿ç”¨ [Dmidecode](http://www.nongnu.org/dmidecode/)<sup>extra / aur</sup> å¯ä»¥å®Œæ•´æŸ¥çœ‹ç³»ç»Ÿç»å¤§éƒ¨åˆ†ç¡¬ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¾ƒéš¾å¾—åˆ°çš„å†…å­˜é¢‘ç‡ç­‰ã€‚

1. å®‰è£… Dmidecodeï¼š

::: code-group

```bash [extra]
sudo pacman -S dmidecode
```

```bash [aur (git)]
yay -S dmidecode-git
```

:::

2. è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ Dmidecode æŸ¥çœ‹ç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯ï¼š

```bash
sudo dmidecode
```

## ç³»ç»Ÿå¿«ç…§ï¼ˆå¤‡ä»½ï¼‰ä¸æ–‡ä»¶ä¼ è¾“

### ä» Timeshift å¿«ç…§ä¸­æ¢å¤

::: tip â„¹ï¸ æç¤º

Timeshift è¿˜èƒ½æ¢å¤åˆ°å…¶å®ƒç¡¬ç›˜ç”¨ä½œç³»ç»Ÿè¿ç§»ï¼Œé€šè¿‡ arch å®‰è£…ç›˜é‡æ–°å®‰è£…å¼•å¯¼å³å¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

:::

#### è‹¥èƒ½å¤Ÿè¿›å…¥æ¡Œé¢ç¯å¢ƒ ğŸ˜

ç›´æ¥æ‰“å¼€ Timeshiftï¼Œé€‰æ‹©å¿«ç…§åæ ¹æ®æç¤ºè¿˜åŸå³å¯ã€‚

#### è‹¥æ— æ³•è¿›å…¥æ¡Œé¢ç¯å¢ƒ

1. é€šè¿‡ `Ctrl` + `Alt` + `F2 ~ F6` è¿›å…¥ tty ç»ˆç«¯

2. ä½¿ç”¨å¿«ç…§è¿˜åŸç³»ç»Ÿï¼š

```bash
sudo timeshift --list # è·å–å¿«ç…§åˆ—è¡¨
sudo timeshift --restore --snapshot '20XX-XX-XX_XX-XX-XX' --skip-grub # é€‰æ‹©ä¸€ä¸ªå¿«ç…§è¿›è¡Œè¿˜åŸï¼Œå¹¶è·³è¿‡ GRUB å®‰è£…ï¼Œä¸€èˆ¬æ¥è¯´ GRUB ä¸éœ€è¦é‡æ–°å®‰è£…
```

3. æ ¹æ®æç¤ºç»§ç»­ï¼Œå®Œæˆè¿˜åŸ

#### è‹¥æ— æ³•è¿›å…¥ç³»ç»Ÿ ğŸ˜±

æ­¤æ—¶ç³»ç»Ÿä¸€èˆ¬å·²ç»å®Œå…¨å¥”æºƒï¼Œå¯ä»¥é€šè¿‡ Live CD è¿›è¡Œè¿˜åŸã€‚ï¼ˆè‹¥ä½¿ç”¨ arch å®‰è£…ç›˜è¯·è¿æ¥ç½‘ç»œå’Œé…ç½®å¥½æºåå®‰è£… Timeshiftï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼è¿˜åŸï¼‰

1. è¿›å…¥ Live ç³»ç»Ÿåæ‰“å¼€ Timeshiftï¼Œç‚¹å‡»è®¾ç½®æŒ‰é’®ï¼Œè®¾ç½®ä¸ºåŸæ¥å¿«ç…§çš„å­˜å‚¨ä½ç½®ã€‚
2. é€‰æ‹©å¿«ç…§åæ ¹æ®æç¤ºè¿˜åŸå³å¯ã€‚

æˆ–è€…é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œè¿˜åŸï¼Œä½†éœ€è¦é¦–å…ˆè®¾ç½®åŸæ¥å¿«ç…§å­˜å‚¨çš„ä½ç½®ï¼š

```bash
sudo timeshift --restore --snapshot-device /dev/sdbx
```

åç»­æ­¥éª¤åŒ [è‹¥æ— æ³•è¿›å…¥æ¡Œé¢ç¯å¢ƒ](#è‹¥æ— æ³•è¿›å…¥æ¡Œé¢ç¯å¢ƒ)ã€‚

#### æ¢å¤åæ— æ³•æŒ‚è½½ç›®å½•

Timeshift æ¢å¤ Btrfs å¿«ç…§æ—¶ï¼Œå¯èƒ½å‡ºç°ç”±äºå­å· ID å˜æ›´å¯¼è‡´æ— æ³•æŒ‚è½½ç›®å½•è€Œæ— æ³•è¿›å…¥ç³»ç»Ÿã€‚

æ­¤æ—¶å¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹ fstab é…ç½®ï¼Œç§»é™¤ `subvolid` å‚æ•°ï¼Œæ”¹ä¸ºé€šè¿‡åç§°æŒ‡å®šå­å·ã€‚

ä½¿ç”¨ `vim` ç¼–è¾‘å™¨ä¿®æ”¹ `/etc/fstab` æ–‡ä»¶ï¼š

```bash
vim /etc/fstab
```

è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š

- åˆ é™¤ `/` å’Œ `/home` æ¡ç›®ä¸­æœ€åçš„ `subvolid=xxx` å‚æ•°

ä¿å­˜åé‡å¯å³å¯æ­£å¸¸ä½¿ç”¨ã€‚ä»¥åæ¢å¤å¿«ç…§æ—¶æ— éœ€å†æ¬¡è¿›è¡Œæ­¤æ“ä½œã€‚

ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ›´æ­£ `subvolid` ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ­£ç¡®çš„ IDï¼š

```bash
sudo btrfs sub list -u /
```

#### æ¢å¤åæ— æ³•æŒ‚è½½ boot

Timeshift æ¢å¤ Btrfs å¿«ç…§æ—¶ï¼Œå¯èƒ½å‡ºç°ç”±äºå†…æ ¸ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´æ— æ³•æŒ‚è½½ boot åˆ†åŒºè€Œæ— æ³•è¿›å…¥ç³»ç»Ÿã€‚æ‰§è¡Œ `journalctl -xb` æŸ¥çœ‹ï¼Œå¯èƒ½ä¼šå‘ç° _unknown filesystem type 'vfat'_ errorã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªè§£æ³•ï¼šè¿›å…¥ archiso å¹¶[è”ç½‘](../rookie/basic-install.md#_3-è¿æ¥ç½‘ç»œ)åï¼Œæ‰§è¡Œä»¥ä¸‹ä¿®å¤ï¼š

```bash
# æ‰‹åŠ¨æŒ‚è½½å­å· / å’Œ /bootï¼ˆnvmexnxpx å¡«å†™å®é™…åˆ†åŒºå·ï¼‰
mount -t btrfs -o subvol=/@,compress=zstd /dev/nvmexnxpx /mnt
mount /dev/nvmexnxpx /mnt/boot
# chroot
arch-chroot /mnt
# æ›´æ–°å†…æ ¸ä¸è½¯ä»¶åŒ…
pacman -Syu linux
# é‡å¯
reboot
```

#### å®šæ—¶ä»»åŠ¡ä¸ç”Ÿæ•ˆ

Timeshift è®¾å®šä»»åŠ¡åå®šæ—¶ä¸ç”Ÿæ•ˆï¼Œé‚£æ˜¯å› ä¸ºç›¸å…³çš„æœåŠ¡ `cron` æ²¡æœ‰å¯åŠ¨å¯¼è‡´çš„é—®é¢˜ã€‚
åœ¨ç»ˆç«¯å‘½ä»¤è¡Œä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç¬¬ä¸€è¡Œä¸ºè®¾ç½®å¼€æœºå¯åŠ¨ï¼Œç¬¬äºŒè¡Œä¸ºå¯åŠ¨ç›¸å…³æœåŠ¡ï¼š

```bash
sudo systemctl enable --now cronie.service
sudo systemctl start --now cronie.service
```

### rsync å‘½ä»¤

æœ‰ä¸€ç‚¹ Linux ç»éªŒçš„åŒå­¦åº”è¯¥çŸ¥é“ `scp` è¿™ä¸ªå‘½ä»¤ã€‚å®ƒå¸¸è¢«ç”¨æ¥åœ¨æœåŠ¡å™¨é—´ä¼ è¾“æ–‡ä»¶ã€‚

ä½†æ˜¯ç›®å‰å®ƒåº”è¯¥è¢«æ›´ç°ä»£çš„å·¥å…· [rsync](https://rsync.samba.org/) æ›¿ä»£ã€‚å…¶æ‹¥æœ‰å³æ—¶å‹ç¼©ã€å·®é‡ä¼ è¾“ç­‰æ–°ç‰¹æ€§ã€‚åŒæ—¶ï¼Œ `rsync` ä¹Ÿè¢«ç”¨æ¥è¿›è¡Œå¤‡ä»½æ“ä½œï¼ˆTimeshift çš„ RSYNC æ¨¡å¼å³åŸºäºæ­¤å®ç°ï¼‰ã€‚

```bash
rsync foo.txt me@server:/home/me/ # æœ€åŸºç¡€çš„å¤åˆ¶æ–‡ä»¶ã€‚ä¸ scp çš„æ“ä½œå®Œå…¨ç›¸åŒ
rsync -a bar/ me@server:/home/me/ # -aï¼šæ ‡è®°å®ç°ç›®å½•å¤åˆ¶ç­‰ã€‚æ¯” scp -r èƒ½æ›´å¥½çš„å¤„ç†ç¬¦å·é“¾æ¥ç­‰æƒ…å†µ
```

> ğŸ”— ç›¸å…³é“¾æ¥ï¼š
>
> - [ArchWiki ç›¸å…³å†…å®¹](https://wiki.archlinux.org/index.php/Rsync#Full_system_backup)
